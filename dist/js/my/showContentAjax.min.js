/*BBS_Demo_Github-0.0.1.js 2017-04-06 17:19 */
$(function(){function a(a){var c="";return c=a.substr(0,200),"</"==c.substring(198,200)&&(c=b(c,198,""),c=b(c,199,"")),"<"==c.substring(199,200)&&(c=b(c,199,"")),c+='...<span class="showAllContent"><strong>显示全部</strong></span>'}function b(a,b,c){return a.substr(0,b-1)+c+a.substring(b,a.length)}var c=$.ajax({url:"http://bbs-demo:8080/src/ajax/content.json",type:"GET",dataType:"json"}),d=function(b){var c="";$.each(b,function(b,d){c+="<h4><strong>"+d.user+"</strong> 发表于 <strong>"+d.date+"</strong></h4><h3>"+d.title+'</h3><div class="quesContent">'+a(d.content)+'</div><div class="quesFooter"><span class="showComment" data-id="'+d.id+'">'+d.count+'条评论</span><span class="hideContent"><strong>收起内容</strong></span></div><hr noshade="noshade" size="3"><div class="commentList"></div>'});var d=$(".myQues").detach();return d.html(c),$(".container").append(d),$(".hideContent").hide(),e(b),f(b),h()},e=function(a){$.each($(".quesContent"),function(b,c){$(this).on("click",".showAllContent",function(){var c=$(".quesContent").eq(b).detach();c.html(a[b].content),$(".quesFooter").eq(b).before(c),$(".hideContent").eq(b).show()})})},f=function(b){$.each($(".quesFooter"),function(c,d){var e=$(this);e.on("click",".hideContent",function(){var d=$(".quesContent").eq(c).detach(),f=a(b[c].content);d.html(f),e.before(d),$(".hideContent").eq(c).hide()})})},g=c.done(d),h=function(){$.each($(".quesFooter"),function(a,b){var c=$(this);c.on("click",".showComment",function(){var b=this,c=$(".commentList").eq(a);if(c.is(":hidden")?c.show():c.hide(),!c.has("form").length)return $.ajax({url:"http://bbs-demo:8080/src/php/show_comment.php",type:"GET",dataType:"json",data:{titleid:$(b).attr("data-id")},beforeSend:function(a,b){c.append('<dl class="comment_load"><dd>正在加载评论</dd></dl>')}})})})};g.done(function(a){commentL.find(".comment_load").hide();var b=0;$.each(a,function(a,c){b=c.count,commentL.append('<dl class="comment_content"><dt>'+c.user+"</dt><dd>"+c.comment+'</dd><dd class="date">'+c.date+"</dd></dl>")}),commentL.append('<dl><dd><span class="load_more">加载更多评论</span></dd></dl>');var c=2;c>b&&(commentL.find(".load_more").off("click"),commentL.find(".load_more").hide()),commentL.append('<form><dl class="comment_add"><dt><textarea name="comment"></textarea></dt><dd><input type="hidden" name="titleid" value="'+$(showComment).attr("data-id")+'" /><input type="hidden" name="user" value="'+$.cookie("user")+'" /><input type="button" value="发表" /></dd></dl></form>')})});