/*BBS_Demo_Github-0.0.1.js 2017-04-05 23:42 */
$(function(){function a(a){var c="";return c=a.substr(0,200),"</"==c.substring(198,200)&&(c=b(c,198,""),c=b(c,199,"")),"<"==c.substring(199,200)&&(c=b(c,199,"")),c+='...<span class="showAllContent"><strong>显示全部</strong></span>'}function b(a,b,c){return a.substr(0,b-1)+c+a.substring(b,a.length)}var c=$.ajax({url:"http://bbs-demo/ajax/content.json",type:"GET",dataType:"json"}),d=function(b){var c="";$.each(b,function(b,d){c+="<h4><strong>"+d.user+"</strong> 发表于 <strong>"+d.date+"</strong></h4><h3>"+d.title+'</h3><div class="quesContent">'+a(d.content)+'</div><div class="quesFooter"><span class="showComment" data-id="'+d.id+'">'+d.count+'条评论</span><span class="hideContent"><strong>收起内容</strong></span></div><hr noshade="noshade" size="3"><div class="commentList"></div>'});var d=$(".myQues").detach();d.html(c),$(".container").append(d),$(".hideContent").hide(),g()},e=function(a){return $.each($(".quesContent"),function(b,c){$(this).on("click",".showAllContent",function(){var c=$(".quesContent").eq(b).detach();c.html(a[b].content),$(".quesFooter").eq(b).before(c),$(".hideContent").eq(b).show()})}),a},f=function(b){return $.each($(".quesFooter"),function(c,d){var e=$(this);e.on("click",".hideContent",function(){var d=$(".quesContent").eq(c).detach(),f=a(b[c].content);d.html(f),e.before(d),$(".hideContent").eq(c).hide()})}),b},g=function(){$.each($(".quesFooter"),function(a,b){var c=$(this);c.on("click",".showComment",function(){var b=this,c=$(".commentList").eq(a);if(!c.has("form").length){var d=$.ajax({url:"http://bbs-demo/ajax/comment.json",type:"GET",dataType:"json",beforeSend:function(a,b){c.append('<dl class="comment_load"><dd>正在加载评论</dd></dl>')}});d.done(function(a){c.find(".comment_load").hide();var d=0;$.each(a,function(a,b){d=b.count,c.append('<dl class="comment_content"><dt>'+b.user+"</dt><dd>"+b.comment+'</dd><dd class="date">'+b.date+"</dd></dl>")}),c.append('<dl><dd><span class="load_more">加载更多评论</span></dd></dl>');var e=2;e>d&&(c.find(".load_more").off("click"),c.find(".load_more").hide()),c.append('<form><dl class="comment_add"><dt><textarea name="comment"></textarea></dt><dd><input type="hidden" name="titleid" value="'+$(b).attr("data-id")+'" /><input type="hidden" name="user" value="'+$.cookie("user")+'" /><input type="button" value="发表" /></dd></dl></form>')})}c.is(":hidden")?c.show():c.hide()})})};c.done(d).then(e).then(f)});