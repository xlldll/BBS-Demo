/*! BBS_Demo_Github-0.0.1.js 2017-04-04 21:12 */
!function(a){function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(){this.raw=[],this.length=0}function d(){return"___"+D++}function e(a,c){var d=a.prototype,e=new Function;e.prototype=c.prototype,a.prototype=new e,a.prototype.constructor=a,b(a.prototype,d)}function f(a){return E[a]}function g(a){return'"'+a.replace(/\x5C/g,"\\\\").replace(/"/g,'\\"').replace(/\x0A/g,"\\n").replace(/\x09/g,"\\t").replace(/\x0D/g,"\\r")+'"'}function h(a){return a.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(a){return"\\"+a})}function i(a){var b=arguments;return a.replace(/\{([0-9]+)\}/g,function(a,c){return b[c-0+1]})}function j(a){return a=a.replace(/^\s*\*/,""),i('gv({0},["{1}"])',g(a),a.replace(/\[['"]?([^'"]+)['"]?\]/g,function(a,b){return"."+b}).split(".").join('","'))}function k(a,b,c,d,e,f){for(var g=c.length,h=a.split(b),i=0,j=[],k=0,l=h.length;l>k;k++){var m=h[k];if(k){var n=1;for(i++;;){var o=m.indexOf(c);if(0>o){j.push(i>1&&n?b:"",m);break}if(i=d?i-1:0,j.push(i>0&&n?b:"",m.slice(0,o),i>0?c:""),m=m.slice(o+g),n=0,0===i)break}0===i&&(e(j.join("")),f(m),j=[])}else m&&f(m)}i>0&&j.length>0&&(f(b),f(j.join("")))}function l(a,b,c){var d,e=[],f=b.options,h="",i="",m="",n="";return c&&(h="ts(",i=")",m=H,n=I,d=f.defaultFilter),k(a,f.variableOpen,f.variableClose,1,function(a){c&&a.indexOf("|")<0&&d&&(a+="|"+d);var f=a.indexOf("|"),g=(f>0?a.slice(0,f):a).replace(/^\s+/,"").replace(/\s+$/,""),k=f>0?a.slice(f+1):"",o=0===g.indexOf("*"),p=[o?"":h,j(g),o?"":i];if(k){k=l(k,b);for(var q=k.split("|"),r=0,s=q.length;s>r;r++){var t=q[r],u=t.match(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i);u&&(p.unshift('fs["'+u[1]+'"]('),u[3]&&p.push(",",u[3]),p.push(")"))}}e.push(m,p.join(""),n)},function(a){e.push(m,c?g(a):a,n)}),e.join("")}function m(a,b){this.value=a,this.engine=b}function n(a,b){this.value=a,this.engine=b,this.children=[],this.cloneProps=[]}function o(a,b){var c=a.stack,d=b?c.find(function(a){return a instanceof b}):c.bottom();if(d){for(var e;(e=c.top())!==d;){if(!e.autoClose)throw new Error(e.type+" must be closed manually: "+e.value);e.autoClose(a)}d.close(a)}return d}function p(a,b){var c=a.match(/^\s*([a-z0-9\/\._-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/\._-]+)\s*\))?\s*/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.master=c[3],this.name=c[1],n.call(this,a,b),this.blocks={}}function q(a,b){var c=a.match(/^\s*([a-z0-9\/\._-]+)\s*$/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.name=c[1],n.call(this,a,b),this.cloneProps=["name"]}function r(a,b){var c=a.match(/^\s*([a-z0-9\/\._-]+)\s*$/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.name=c[1],n.call(this,a,b),this.cloneProps=["name","state","blocks","target"],this.blocks={}}function s(a,b){var c=a.match(/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.name=c[1],this.expr=c[2],n.call(this,a,b),this.cloneProps=["name","expr"]}function t(a,b){var c=a.match(/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.name=c[1],this.args=c[3],n.call(this,a,b),this.cloneProps=["name","args"]}function u(a,b){var c=a.match(/^\s*([a-z0-9\/\._-]+)\s*(\(([\s\S]*)\))?\s*$/i);if(!c)throw new Error("Invalid "+this.type+" syntax: "+a);this.name=c[1],this.args=c[3],n.call(this,a,b),this.cloneProps=["name","args"]}function v(a,b){var c=new RegExp(i("^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$",h(b.options.variableOpen),h(b.options.variableClose)),"i"),d=a.match(c);if(!d)throw new Error("Invalid "+this.type+" syntax: "+a);this.list=d[1],this.item=d[2],this.index=d[4],n.call(this,a,b),this.cloneProps=["list","item","index"]}function w(a,b){n.call(this,a,b)}function x(a,b){w.call(this,a,b)}function y(a,b){n.call(this,a,b)}function z(a,b){b.target=a;var c=b.engine,d=a.name;if(c.targets[d])switch(c.options.namingConflict){case"override":c.targets[d]=a,b.targets.push(d);case"ignore":break;default:throw new Error("[ETPL_TARGET_EXISTS]"+d)}else c.targets[d]=a,b.targets.push(d)}function A(a,b,c){a.commandTypes[b]=c,c.prototype.type=b}function B(a){this.options={commandOpen:"<!--",commandClose:"-->",commandSyntax:/^\s*(\/)?([a-z]*)\s*(?::([\s\S]*))?$/,variableOpen:"${",variableClose:"}",defaultFilter:"html"},this.commandTypes={},A(this,"target",p),A(this,"block",q),A(this,"import",r),A(this,"use",u),A(this,"var",s),A(this,"for",v),A(this,"if",w),A(this,"elif",x),A(this,"else",y),A(this,"filter",t),this.config(a),this.targets={},this.filters=b({},F)}function C(a,b){function d(){var a;if(l.length>0&&(a=l.join(""))){var c=new m(a,b);c.beforeAdd(j),i.top().addChild(c),l=[],b.options.strip&&j.current instanceof n&&(c.value=a.replace(/^[\x20\t\r]*\n/,"")),j.current=c}}var e,f=b.options.commandOpen,g=b.options.commandClose,h=b.options.commandSyntax,i=new c,j={engine:b,targets:[],stack:i,target:null,deps:{}},l=[];k(a,f,g,0,function(a){var c,i=h.exec(a);if(i&&(c=i[2]||"target")&&(e=b.commandTypes[c.toLowerCase()])&&"function"==typeof e){d();var k=j.current;b.options.strip&&k instanceof m&&(k.value=k.value.replace(/\r?\n[\x20\t]*$/,"\n")),i[1]?k=o(j,e):(k=new e(i[3],b),"function"==typeof k.init&&k.init(j),k.beforeOpen(j),k.open(j)),j.current=k}else/^\s*\/\//.test(a)||l.push(f,a,g);e=null},function(a){l.push(a)}),d(),o(j);var p=[];for(var q in j.deps)p.push(q);return{targets:j.targets,deps:p}}c.prototype={push:function(a){this.raw[this.length++]=a},pop:function(){if(this.length>0){var a=this.raw[--this.length];return this.raw.length=this.length,a}},top:function(){return this.raw[this.length-1]},bottom:function(){return this.raw[0]},find:function(a){for(var b=this.length;b--;){var c=this.raw[b];if(a(c))return c}}};var D=178245,E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},F={html:function(a){return a.replace(/[&<>"']/g,f)},url:encodeURIComponent,raw:function(a){return a}},G='var r="";',H="r+=",I=";",J="return r;",K="undefined"!=typeof navigator&&navigator.userAgent.match(/msie\s*([0-9]+)/i);K&&K[1]-0<8&&(G="var r=[],ri=0;",H="r[ri++]=",J='return r.join("");'),m.prototype={getRendererBody:function(){var a=this.value,b=this.engine.options;return!a||b.strip&&/^\s*$/.test(a)?"":l(a,this.engine,1)},clone:function(){return this}},n.prototype={addChild:function(a){this.children.push(a)},open:function(a){var b=a.stack.top();b&&b.addChild(this),a.stack.push(this)},close:function(a){a.stack.top()===this&&a.stack.pop()},getRendererBody:function(){for(var a=[],b=this.children,c=0;c<b.length;c++)a.push(b[c].getRendererBody());return a.join("")},clone:function(){for(var a=this.constructor,b=new a(this.value,this.engine),c=0,d=this.children.length;d>c;c++)b.addChild(this.children[c].clone());for(var c=0,d=this.cloneProps.length;d>c;c++){var e=this.cloneProps[c];b[e]=this[e]}return b}};var L='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';e(p,n),e(q,n),e(r,n),e(s,n),e(t,n),e(u,n),e(v,n),e(w,n),e(x,w),e(y,w),p.prototype.init=function(a){this.master&&(a.deps[this.master]=!0)},u.prototype.init=r.prototype.init=function(a){a.deps[this.name]=!0};var M={READING:1,READED:2,APPLIED:3,READY:4};r.prototype.applyMaster=p.prototype.applyMaster=function(a){function b(a){var d=a.children;if(d instanceof Array)for(var e=0,f=d.length;f>e;e++){var g=d[e];g instanceof q&&c[g.name]&&(g=d[e]=c[g.name]),b(g)}}if(this.state>=M.APPLIED)return 1;var c=this.blocks,d=this.engine.targets[a];if(d){if(d.applyMaster(d.master))return this.children=d.clone().children,b(this),this.state=M.APPLIED,1}else if("error"===this.engine.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+a+", when extended by "+(this.target?this.target.name:this.name))},p.prototype.isReady=function(){function a(e){for(var f=0,g=e.children.length;g>f;f++){var h=e.children[f];if(h instanceof r){var i=b.targets[h.name];if(!i&&"error"===b.options.missTarget)throw new Error("[ETPL_MISS_TARGET]"+h.name+", when imported by "+c);d=d&&i&&i.isReady(b)}else h instanceof n&&a(h)}}if(this.state>=M.READY)return 1;var b=this.engine,c=this.name,d=1;return this.applyMaster(this.master)?(a(this),d&&(this.state=M.READY),d):void 0},p.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var a=new Function("data","engine",[L,G,this.getRendererBody(),J].join("\n")),b=this.engine;return this.renderer=function(c){return a(c,b)},this.renderer}return null},p.prototype.open=function(a){o(a),n.prototype.open.call(this,a),this.state=M.READING,z(this,a)},s.prototype.open=u.prototype.open=function(a){a.stack.top().addChild(this)},q.prototype.open=function(a){n.prototype.open.call(this,a),a.stack.find(function(a){return a.blocks}).blocks[this.name]=this},x.prototype.open=function(a){var b=new y;b.open(a);var c=o(a,w);c.addChild(this),a.stack.push(this)},y.prototype.open=function(a){var b=o(a,w);b.addChild(this),a.stack.push(this)},r.prototype.open=function(a){this.parent=a.stack.top(),this.target=a.target,n.prototype.open.call(this,a),this.state=M.READING},u.prototype.close=s.prototype.close=function(){},r.prototype.close=function(a){n.prototype.close.call(this,a),this.state=M.READED},p.prototype.close=function(a){n.prototype.close.call(this,a),this.state=this.master?M.READED:M.APPLIED,a.target=null},r.prototype.autoClose=function(a){var b=this.parent.children;b.push.apply(b,this.children),this.children.length=0;for(var c in this.blocks)this.target.blocks[c]=this.blocks[c];this.blocks={},this.close(a)},n.prototype.beforeOpen=m.prototype.beforeAdd=function(a){if(!a.stack.bottom()){var b=new p(d(),a.engine);b.open(a)}},p.prototype.beforeOpen=function(){},r.prototype.getRendererBody=function(){return this.applyMaster(this.name),n.prototype.getRendererBody.call(this)},u.prototype.getRendererBody=function(){return i("{0}engine.render({2},{{3}}){1}",H,I,g(this.name),l(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(a,b,c){return(b||"")+g(c)+":"}))},s.prototype.getRendererBody=function(){return this.expr?i("v[{0}]={1};",g(this.name),l(this.expr,this.engine)):""},w.prototype.getRendererBody=function(){return i("if({0}){{1}}",l(this.value,this.engine),n.prototype.getRendererBody.call(this))},y.prototype.getRendererBody=function(){return i("}else{{0}",n.prototype.getRendererBody.call(this))},v.prototype.getRendererBody=function(){return i('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',d(),l(this.list,this.engine),g(this.index||d()),g(this.item),d(),d(),n.prototype.getRendererBody.call(this))},t.prototype.getRendererBody=function(){var a=this.args;return i("{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}",G,J,H,I,n.prototype.getRendererBody.call(this),g(this.name),a?","+l(a,this.engine):"")},B.prototype.config=function(a){b(this.options,a)},B.prototype.compile=B.prototype.parse=function(a){var b=new Function('return ""');if(a){var c=C(a,this),d=c.targets;d.length&&(b=this.targets[d[0]].getRenderer())}return b},B.prototype.getRenderer=function(a){var b=this.targets[a];return b?b.getRenderer():void 0},B.prototype.render=function(a,b){var c=this.getRenderer(a);return c?c(b):""},B.prototype.addCommand=function(a,b){var c=b;"function"!=typeof c&&(c=function(a,b){n.call(this,a,b)},c.prototype=b),e(c,n),A(this,a,c)},B.prototype.addFilter=function(a,b){"function"==typeof b&&(this.filters[a]=b)};var N=new B;N.Engine=B,N.version="3.2.0",N.Command=n,N.util={inherits:e,stringFormat:i,stringLiteralize:g,compileVariable:l,parseSource:C},"object"==typeof exports&&"object"==typeof module?exports=module.exports=N:"function"==typeof define&&define.amd?define(N):a.etpl=N}(this);